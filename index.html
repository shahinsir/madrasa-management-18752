<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>মাদ্রাসা ম্যানেজমেন্ট সিস্টেম</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- PWA Configurations -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="https://i.ibb.co.com/hhVX9hp/android-chrome-192x192.png">
    <link rel="apple-touch-icon" href="https://i.ibb.co.com/hhVX9hp/android-chrome-192x192.png">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="মাদ্রাসা ম্যানেজমেন্ট">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap');
        
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Hind Siliguri', sans-serif !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        html {
            height: 100%;
            width: 100%;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .nav-tab {
            transition: all 0.3s ease;
        }
        
        .nav-tab.active {
            background: #4f46e5;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .index-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .madrasa-info {
            background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
            border-radius: 10px;
            padding: 10px 15px;
            margin-top: 10px;
        }
        
        .info-item {
            display: inline-block;
            margin-right: 20px;
            font-size: 14px;
            color: #4a5568;
        }
        
        .info-item i {
            margin-right: 5px;
            color: #4f46e5;
        }
        
        .user-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .admin-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .user-badge-normal {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        /* PWA ফিক্স */
        @media (display-mode: standalone) {
            body {
                padding: 0 !important;
                margin: 0 !important;
            }
            
            #main-content {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
        
        /* লগইন স্ক্রিন স্টাইলস */
        .login-container {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .login-title {
            font-size: 24px;
            font-weight: 700;
            color: #4a5568;
            margin-bottom: 8px;
        }
        
        .login-subtitle {
            font-size: 14px;
            color: #718096;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            box-sizing: border-box;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .password-container {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #718096;
            cursor: pointer;
            padding: 5px;
        }
        
        .login-button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 48px;
        }
        
        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .login-footer {
            text-align: center;
            margin-top: 20px;
            font-size: 13px;
            color: #a0aec0;
        }
        
        .role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin: 5px;
        }
        
        .badge-admin {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .badge-user {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .login-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        /* মোবাইল রেস্পন্সিভ */
        @media (max-width: 768px) {
            .p-8 {
                padding: 1rem !important;
            }
            
            .login-logo {
                width: 70px;
                height: 70px;
                font-size: 20px;
            }
            
            .login-title {
                font-size: 20px;
            }
            
            .nav-tab {
                padding: 8px 12px;
                font-size: 13px;
            }
        }
        
        /* iOS সেফ এরিয়া */
        @supports (-webkit-touch-callout: none) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <!-- লগইন মডেল -->
    <div id="loginModal" class="fixed inset-0 bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center z-50 login-container">
        <div class="glass-card p-6 md:p-8 w-full max-w-md mx-4">
            <div class="login-header">
                <div class="login-logo">
                    MA
                </div>
                <h1 class="login-title">মাদ্রাসা ম্যানেজমেন্ট</h1>
                <p class="login-subtitle">মেহেরপুর আনছারুল উলূম আলিম মাদ্রাসা</p>
                <div class="flex justify-center mt-4">
                    <span class="role-badge badge-admin">এডমিন</span>
                    <span class="role-badge badge-user">ইউজার</span>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">ইমেইল এড্রেস</label>
                <input type="email" id="loginEmail" class="form-input" placeholder="আপনার ইমেইল লিখুন" value="admin@madrasa.com">
            </div>
            
            <div class="form-group">
                <label class="form-label">পাসওয়ার্ড</label>
                <div class="password-container">
                    <input type="password" id="loginPassword" class="form-input pr-12" placeholder="আপনার পাসওয়ার্ড লিখুন" value="password123">
                    <button type="button" class="toggle-password" onclick="togglePassword()">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <div class="login-options">
                <label class="flex items-center">
                    <input type="checkbox" id="rememberMe" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" checked>
                    <span class="ml-2 text-gray-700">মনে রাখুন</span>
                </label>
                <a href="#" class="text-blue-600 hover:text-blue-800 text-sm" onclick="showForgotPassword()">
                    পাসওয়ার্ড ভুলে গেছেন?
                </a>
            </div>
            
            <button onclick="login()" class="login-button">
                <i class="fas fa-sign-in-alt mr-2"></i>লগইন করুন
            </button>
            
            <div class="login-footer mt-6 pt-6 border-t border-gray-200">
                <p class="text-sm text-gray-600">
                    <strong>ডিফল্ট এডমিন:</strong> admin@madrasa.com / password123<br>
                    <strong>ডিফল্ট ইউজার:</strong> user@madrasa.com / viewer123
                </p>
                <p class="text-xs mt-3 text-gray-500">
                    EIIN: ১৩০২৯০ | মাদ্রাসা কোড: ১৮৭৫২
                </p>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto hidden" id="main-content">
        <!-- হেডার -->
        <div class="glass-card p-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-center md:text-left mb-6 md:mb-0">
                    <div class="flex items-center justify-center md:justify-start">
                        <h1 class="text-3xl md:text-4xl font-bold gradient-text">মেহেরপুর আনছারুল উলূম আলিম মাদ্রাসা</h1>
                        <span id="userRoleBadge" class="user-badge ml-4"></span>
                    </div>
                    
                    <!-- মাদ্রাসা তথ্য -->
                    <div class="madrasa-info mt-3">
                        <span class="info-item">
                            <i class="fas fa-hashtag"></i>মাদ্রাসা কোড: <strong>১৮৭৫২</strong>
                        </span>
                        <span class="info-item">
                            <i class="fas fa-id-card"></i>EIIN No: <strong>১৩০২৯০</strong>
                        </span>
                        <span class="info-item">
                            <i class="fas fa-phone"></i>মোবাইল: <strong>০১৩০৯-১৩০২৯০</strong>
                        </span>
                        <span class="info-item">
                            <i class="fas fa-map-marker-alt"></i>মেহেরপুর, গোলাপগঞ্জ, সিলেট
                        </span>
                    </div>
                    
                    <p class="text-gray-600 mt-4">সম্পূর্ণ ডিজিটাল ম্যানেজমেন্ট সিস্টেম</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p class="text-gray-600" id="currentDateBangla"></p>
                        <p class="text-sm text-gray-500" id="currentTime"></p>
                        <button onclick="logout()" class="text-sm text-red-600 hover:text-red-800 mt-1">
                            <i class="fas fa-sign-out-alt mr-1"></i>লগআউট
                        </button>
                    </div>
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                        MA
                    </div>
                </div>
            </div>
        </div>

        <!-- নেভিগেশন ট্যাব -->
        <div class="glass-card p-4 mb-8">
            <div class="flex flex-wrap gap-2 justify-center">
                <button onclick="showSection('dashboard')" id="tab-dashboard" class="nav-tab px-6 py-3 rounded-lg bg-blue-50 text-blue-700 font-semibold active">
                    <i class="fas fa-tachometer-alt mr-2"></i>ড্যাশবোর্ড
                </button>
                <button onclick="showSection('students')" id="tab-students" class="nav-tab px-6 py-3 rounded-lg bg-green-50 text-green-700 font-semibold">
                    <i class="fas fa-user-graduate mr-2"></i>ছাত্র-ছাত্রী
                </button>
                <button onclick="showSection('teachers')" id="tab-teachers" class="nav-tab px-6 py-3 rounded-lg bg-purple-50 text-purple-700 font-semibold">
                    <i class="fas fa-chalkboard-teacher mr-2"></i>শিক্ষক-কর্মচারী
                </button>
                <button onclick="showSection('finance')" id="tab-finance" class="nav-tab px-6 py-3 rounded-lg bg-red-50 text-red-700 font-semibold">
                    <i class="fas fa-money-bill-wave mr-2"></i>আর্থিক ব্যবস্থাপনা
                </button>
            </div>
        </div>

        <!-- বাকি সব সেকশন আপনার আগের কোডের মতোই থাকবে -->
        <!-- আমি শুধু লগইন এবং PWA ইস্যু ফিক্স করছি -->

        <!-- ড্যাশবোর্ড সেকশন -->
        <div id="section-dashboard" class="section-content">
            <!-- আপনার আগের ড্যাশবোর্ড কোড -->
        </div>

        <!-- ছাত্র-ছাত্রী সেকশন -->
        <div id="section-students" class="section-content hidden">
            <!-- আপনার আগের ছাত্র সেকশন কোড -->
        </div>

        <!-- শিক্ষক-কর্মচারী সেকশন -->
        <div id="section-teachers" class="section-content hidden">
            <!-- আপনার আগের শিক্ষক সেকশন কোড -->
        </div>

        <!-- আর্থিক ব্যবস্থাপনা সেকশন -->
        <div id="section-finance" class="section-content hidden">
            <!-- আপনার আগের আর্থিক সেকশন কোড -->
        </div>

        <!-- ফুটার -->
        <div class="glass-card p-6 mt-8 text-center text-gray-600">
            <p>© 2024 মেহেরপুর আনছারুল উলূম আলিম মাদ্রাসা। সকল অধিকার সংরক্ষিত।</p>
            <p class="text-sm mt-2">ডেভেলপড: মাদ্রাসা ম্যানেজমেন্ট সিস্টেম টিম | মাদ্রাসা কোড: ১৮৭৫২ | EIIN No: ১৩০২৯০</p>
            <p class="text-xs mt-1 text-blue-600" id="syncStatus">অনলাইন</p>
        </div>
    </div>

    <!-- মডেল ফরম (আপনার আগের কোডের মতোই) -->
    <!-- আমি শুধু JavaScript অংশে ফিক্স করছি -->

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4wF9q7V9v9v9v9v9v9v9v9v9v9v9v9v9v9v9",
            authDomain: "madrasa-management-18752.firebaseapp.com",
            databaseURL: "https://madrasa-management-18752-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "madrasa-management-18752",
            storageBucket: "madrasa-management-18752.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // ডেটা স্টোরেজ
        let students = [];
        let teachers = [];
        let transactions = [];
        let currentUser = null;
        let currentStudentEditId = null;
        let currentTeacherEditId = null;

        // বাংলা তারিখ ফরম্যাট
        const banglaMonths = [
            'জানুয়ারী', 'ফেব্রুয়ারী', 'মার্চ', 'এপ্রিল', 'মে', 'জুন',
            'জুলাই', 'আগস্ট', 'সেপ্টেম্বর', 'অক্টোবর', 'নভেম্বর', 'ডিসেম্বর'
        ];
        
        const banglaDays = [
            'রবিবার', 'সোমবার', 'মঙ্গলবার', 'বুধবার', 'বৃহস্পতিবার', 'শুক্রবার', 'শনিবার'
        ];

        function updateBanglaDate() {
            const now = new Date();
            const day = banglaDays[now.getDay()];
            const date = now.getDate();
            const month = banglaMonths[now.getMonth()];
            const year = now.getFullYear();
            
            document.getElementById('currentDateBangla').textContent = 
                `${day}, ${date} ${month} ${year}`;
            
            const time = now.toLocaleTimeString('bn-BD');
            document.getElementById('currentTime').textContent = time;
        }

        // লগইন ফাংশন - ফিক্সড
        function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            console.log("Login attempt:", email, password);
            
            // ডিফল্ট এডমিন লগইন
            const defaultAdmin = {
                email: 'admin@madrasa.com',
                password: 'password123',
                role: 'admin'
            };
            
            const defaultViewer = {
                email: 'user@madrasa.com',
                password: 'viewer123',
                role: 'viewer'
            };
            
            if (email === defaultAdmin.email && password === defaultAdmin.password) {
                console.log("Admin login successful");
                currentUser = defaultAdmin;
                handleSuccessfulLogin();
            } else if (email === defaultViewer.email && password === defaultViewer.password) {
                console.log("User login successful");
                currentUser = defaultViewer;
                handleSuccessfulLogin();
            } else {
                alert('ভুল ইমেইল বা পাসওয়ার্ড!');
                console.log("Login failed");
            }
        }

        function handleSuccessfulLogin() {
            try {
                // লগইন মডেল লুকাও
                const loginModal = document.getElementById('loginModal');
                if (loginModal) {
                    loginModal.style.display = 'none';
                    loginModal.classList.add('hidden');
                }
                
                // মূল কন্টেন্ট দেখাও
                const mainContent = document.getElementById('main-content');
                if (mainContent) {
                    mainContent.classList.remove('hidden');
                    mainContent.style.display = 'block';
                }
                
                // UI আপডেট
                updateUIForUserRole();
                
                // Firebase থেকে ডেটা লোড
                loadDataFromFirebase();
                
                // ড্যাশবোর্ড দেখাও
                showSection('dashboard');
                
                // তারিখ আপডেট শুরু করো
                updateBanglaDate();
                setInterval(updateBanglaDate, 60000);
                
                console.log("Login handled successfully");
                alert(`সফলভাবে লগইন হয়েছে! (রোল: ${currentUser.role === 'admin' ? 'এডমিন' : 'ইউজার'})`);
            } catch (error) {
                console.error("Error in handleSuccessfulLogin:", error);
                alert("লগইন প্রসেসে সমস্যা হয়েছে। পেজ রিফ্রেশ করুন।");
            }
        }

        // Firebase থেকে ডেটা লোড
        function loadDataFromFirebase() {
            try {
                // ছাত্র ডেটা
                database.ref('madrasa_18752/students').on('value', (snapshot) => {
                    students = [];
                    snapshot.forEach((childSnapshot) => {
                        students.push({ id: childSnapshot.key, ...childSnapshot.val() });
                    });
                    loadStudents();
                    updateDashboard();
                    updateSyncStatus('ডেটা সিঙ্ক হয়েছে');
                });

                // শিক্ষক ডেটা
                database.ref('madrasa_18752/teachers').on('value', (snapshot) => {
                    teachers = [];
                    snapshot.forEach((childSnapshot) => {
                        teachers.push({ id: childSnapshot.key, ...childSnapshot.val() });
                    });
                    loadTeachers();
                    updateDashboard();
                    updateSyncStatus('ডেটা সিঙ্ক হয়েছে');
                });

                // লেনদেন ডেটা
                database.ref('madrasa_18752/transactions').on('value', (snapshot) => {
                    transactions = [];
                    snapshot.forEach((childSnapshot) => {
                        transactions.push({ id: childSnapshot.key, ...childSnapshot.val() });
                    });
                    loadFinancialData();
                    updateDashboard();
                    updateSyncStatus('ডেটা সিঙ্ক হয়েছে');
                });
            } catch (error) {
                console.error("Error loading data from Firebase:", error);
                updateSyncStatus('ডেটা লোডে সমস্যা');
            }
        }

        function updateSyncStatus(message) {
            const syncStatus = document.getElementById('syncStatus');
            if (syncStatus) {
                syncStatus.textContent = message;
                syncStatus.className = 'text-xs mt-1 text-green-600';
                setTimeout(() => {
                    syncStatus.className = 'text-xs mt-1 text-gray-600';
                }, 3000);
            }
        }

        // ইউজার রোল অনুযায়ী UI কন্ট্রোল
        function updateUIForUserRole() {
            try {
                const isAdmin = currentUser && currentUser.role === 'admin';
                const isViewer = currentUser && currentUser.role === 'viewer';
                
                // রোল বাজ দেখাও
                const roleBadge = document.getElementById('userRoleBadge');
                if (roleBadge) {
                    if (isAdmin) {
                        roleBadge.className = 'user-badge admin-badge';
                        roleBadge.textContent = 'এডমিন';
                        roleBadge.style.display = 'inline-block';
                    } else if (isViewer) {
                        roleBadge.className = 'user-badge user-badge-normal';
                        roleBadge.textContent = 'ইউজার';
                        roleBadge.style.display = 'inline-block';
                    }
                }
                
                // এডিট বাটন কন্ট্রোল
                const addStudentBtn = document.getElementById('addStudentBtn');
                const addTeacherBtn = document.getElementById('addTeacherBtn');
                const financeForm = document.getElementById('financeForm');
                
                if (isAdmin) {
                    if (addStudentBtn) addStudentBtn.classList.remove('hidden');
                    if (addTeacherBtn) addTeacherBtn.classList.remove('hidden');
                    if (financeForm) financeForm.classList.remove('hidden');
                } else {
                    if (addStudentBtn) addStudentBtn.classList.add('hidden');
                    if (addTeacherBtn) addTeacherBtn.classList.add('hidden');
                    if (financeForm) financeForm.classList.add('hidden');
                }
                
                console.log("UI updated for role:", currentUser?.role);
            } catch (error) {
                console.error("Error updating UI for user role:", error);
            }
        }

        function logout() {
            if (confirm('আপনি কি লগআউট করতে চান?')) {
                currentUser = null;
                
                // সব কন্টেন্ট লুকাও
                const mainContent = document.getElementById('main-content');
                if (mainContent) {
                    mainContent.classList.add('hidden');
                    mainContent.style.display = 'none';
                }
                
                // লগইন মডেল দেখাও
                const loginModal = document.getElementById('loginModal');
                if (loginModal) {
                    loginModal.style.display = 'flex';
                    loginModal.classList.remove('hidden');
                }
                
                alert('সফলভাবে লগআউট হয়েছে!');
            }
        }

        // ট্যাব নেভিগেশন
        function showSection(sectionId) {
            // সব সেকশন লুকাও
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
                section.style.display = 'none';
            });
            
            // সব ট্যাব অ্যাক্টিভ ক্লাস রিমুভ
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // নির্বাচিত সেকশন দেখাও
            const selectedSection = document.getElementById(`section-${sectionId}`);
            if (selectedSection) {
                selectedSection.classList.remove('hidden');
                selectedSection.style.display = 'block';
            }
            
            // নির্বাচিত ট্যাব অ্যাক্টিভ করো
            const selectedTab = document.getElementById(`tab-${sectionId}`);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
        }

        // পাসওয়ার্ড টগল ফাংশন
        function togglePassword() {
            const passwordInput = document.getElementById('loginPassword');
            const toggleBtn = document.querySelector('.toggle-password i');
            
            if (passwordInput && toggleBtn) {
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    toggleBtn.className = 'fas fa-eye-slash';
                } else {
                    passwordInput.type = 'password';
                    toggleBtn.className = 'fas fa-eye';
                }
            }
        }

        // ফরগট পাসওয়ার্ড
        function showForgotPassword() {
            alert('অ্যাডমিনের সাথে যোগাযোগ করুন:\n০১৩০৯-১৩০২৯০\nঅথবা\nadmin@madrasa.com');
        }

        // PWA ইনস্টলেশন
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // শো ইনস্টল বাটন
            setTimeout(() => {
                showInstallPrompt();
            }, 5000);
        });

        function showInstallPrompt() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ইউজার PWA ইনস্টল করেছেন');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // DOM কন্টেন্ট লোড হওয়ার পর
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM loaded");
            
            // তারিখ আপডেট
            updateBanglaDate();
            setInterval(updateBanglaDate, 60000);
            
            // ডিফল্ট ভ্যালু সেট
            const financeDate = document.getElementById('financeDate');
            if (financeDate) {
                financeDate.value = new Date().toISOString().split('T')[0];
            }
            
            // অটো লগইন ফর টেস্টিং (প্রোডাকশনে রিমুভ করবেন)
            setTimeout(() => {
                // লগইন বাটনে ইভেন্ট লিসেনার যোগ
                const loginBtn = document.querySelector('[onclick="login()"]');
                if (loginBtn) {
                    loginBtn.addEventListener('click', login);
                }
                
                // ইমেইল/পাসওয়ার্ড ফিল্ডে এন্টার প্রেস করলে লগইন
                const emailInput = document.getElementById('loginEmail');
                const passwordInput = document.getElementById('loginPassword');
                
                if (emailInput && passwordInput) {
                    emailInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') login();
                    });
                    
                    passwordInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') login();
                    });
                }
            }, 100);
            
            console.log("Initialization complete");
        });

        // অনলাইন/অফলাইন ডিটেকশন
        window.addEventListener('online', () => {
            updateSyncStatus('অনলাইন - ডেটা সিঙ্ক হচ্ছে...');
        });

        window.addEventListener('offline', () => {
            updateSyncStatus('অফলাইন মোড - স্থানীয় ডেটা দেখানো হচ্ছে');
        });

        // আপনার আগের অন্যান্য ফাংশনগুলো এখানে যোগ করুন
        // যেমন: saveStudent(), saveTeacher(), loadStudents(), ইত্যাদি
        // আমি শুধু লগইন এবং PWA ইস্যু ফিক্স করেছি

    </script>

    <!-- বাকি আপনার JavaScript কোড এখানে থাকবে -->

</body>
</html>
